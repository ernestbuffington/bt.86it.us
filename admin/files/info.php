<?php

/**
**********************
** BTManager v3.0.2 **
**********************
** http://www.btmanager.org/
** https://github.com/blackheart1/BTManager3.0.2
** http://demo.btmanager.org/index.php
** Licence Info: GPL
** Copyright (C) 2018
** Formerly Known As phpMyBitTorrent
** Created By Antonio Anzivino (aka DJ Echelon)
** And Joe Robertson (aka joeroberts/Black_Heart)
** Project Leaders: Black_Heart, Thor.
** File files/info.php 2018-09-22 00:00:00 Thor
**
** CHANGES
**
** 2018-09-22 - Updated Masthead, Github, !defined('IN_BTM')
**/

if (!defined('IN_BTM'))
{
    require_once($_SERVER['DOCUMENT_ROOT'].'/security.php');
    die ("Error 404 - Page Not Found");
}

$user->set_lang('admin/acp_php_info',$user->ulanguage);
        ob_start();
        @phpinfo(INFO_GENERAL | INFO_CONFIGURATION | INFO_MODULES | INFO_VARIABLES);
        $phpinfo = ob_get_clean();

        $phpinfo = trim($phpinfo);

        // Here we play around a little with the PHP Info HTML to try and stylise
        // it along phpBB's lines ... hopefully without breaking anything. The idea
        // for this was nabbed from the PHP annotated manual
        preg_match_all('#<body[^>]*>(.*)</body>#si', $phpinfo, $output);

        if (empty($phpinfo) || empty($output))
        {
            trigger_error($user->lang['NO_PHPINFO_AVAILABLE'], E_USER_WARNING);
        }

        $output = $output[1][0];

        // expose_php can make the image not exist
        if (preg_match('#<a[^>]*><img[^>]*></a>#', $output))
        {
            $output = preg_replace('#<tr class="v"><td>(.*?<a[^>]*><img[^>]*></a>)(.*?)</td></tr>#s', '<tr class="row1"><td><table class="type2"><tr><td>\2</td><td>\1</td></tr></table></td></tr>', $output);
        }
        else
        {
            $output = preg_replace('#<tr class="v"><td>(.*?)</td></tr>#s', '<tr class="row1"><td><table class="type2"><tr><td>\1</td></tr></table></td></tr>', $output);
        }
        $output = preg_replace('#<table[^>]+>#i', '<table class="phpinfo">', $output);
        $output = preg_replace('#<img border="0"#i', '<img', $output);
        $output = str_replace(array('class="e"', 'class="v"', 'class="h"', '<hr />', '<font', '</font>','<tbody>','</tbody>'), array('class="row1"', 'class="row2"', '', '', '<span', '</span>','',''), $output);
        $output = preg_replace('#<td class="row2">(.*?)</td>#i', '<td class="row2">'.wordwrap('\1', 8, "\n", true).'</td>', $output);

        if (empty($output))
        {
            trigger_error($user->lang['NO_PHPINFO_AVAILABLE'], E_USER_WARNING);
        }

        $orig_output = $output;

        preg_match_all('#<div class="center">(.*)</div>#siU', $output, $output);
        $output = (!empty($output[1][0])) ? $output[1][0] : $orig_output;
    $template->assign_vars(array(
        'PHPINFO'                   => $output,
));
echo $template->fetch('admin/acp_php_info.html');
        close_out();

?>